# ユースケース図

Robocopy GUIアプリケーションのユースケースを示します。

## 全体ユースケース図

```mermaid
flowchart LR
    subgraph Actors
        User((ユーザー))
    end
    
    subgraph System["Robocopy GUI システム"]
        UC1[コピー元フォルダを選択]
        UC2[コピー先フォルダを選択]
        UC3[コピーオプションを設定]
        UC4[ファイル一覧を確認]
        UC5[コピーを実行]
        UC6[コピーを中止]
        UC7[CUIコマンドを確認]
        UC8[進捗を確認]
    end
    
    User --> UC1
    User --> UC2
    User --> UC3
    User --> UC4
    User --> UC5
    User --> UC6
    User --> UC7
    User --> UC8
    
    UC4 -.->|include| UC1
    UC4 -.->|include| UC2
    UC5 -.->|include| UC1
    UC5 -.->|include| UC2
    UC6 -.->|extend| UC5
    UC8 -.->|extend| UC5
```

## 詳細ユースケース図

### フォルダ選択関連

```mermaid
flowchart LR
    subgraph Actors
        User((ユーザー))
    end
    
    subgraph "フォルダ選択"
        UC1[コピー元フォルダを選択]
        UC1a[パスを直接入力]
        UC1b[参照ダイアログで選択]
        
        UC2[コピー先フォルダを選択]
        UC2a[パスを直接入力]
        UC2b[参照ダイアログで選択]
    end
    
    User --> UC1
    User --> UC2
    
    UC1a -.->|extend| UC1
    UC1b -.->|extend| UC1
    UC2a -.->|extend| UC2
    UC2b -.->|extend| UC2
```

### オプション設定関連

```mermaid
flowchart LR
    subgraph Actors
        User((ユーザー))
    end
    
    subgraph "オプション設定"
        UC1[コピーオプションを設定]
        UC1a[サブフォルダコピーを設定]
        UC1b[ミラーリングを設定]
        UC1c[再開可能モードを設定]
        UC1d[リトライ設定を変更]
        UC1e[マルチスレッドを設定]
        UC1f[除外オプションを設定]
        UC1g[ログ出力を設定]
    end
    
    User --> UC1
    
    UC1a -.->|extend| UC1
    UC1b -.->|extend| UC1
    UC1c -.->|extend| UC1
    UC1d -.->|extend| UC1
    UC1e -.->|extend| UC1
    UC1f -.->|extend| UC1
    UC1g -.->|extend| UC1
```

### コピー実行関連

```mermaid
flowchart LR
    subgraph Actors
        User((ユーザー))
        System((robocopy.exe))
    end
    
    subgraph "コピー実行"
        UC1[ファイル一覧を確認<br/>/Lオプションで実行]
        UC2[コピーを実行]
        UC3[コピーを中止]
        UC4[進捗を確認]
        UC5[結果を確認]
    end
    
    User --> UC1
    User --> UC2
    User --> UC3
    User --> UC4
    User --> UC5
    
    UC1 --> System
    UC2 --> System
    UC3 -.->|extend| UC2
    UC4 -.->|extend| UC2
    UC5 -.->|include| UC2
```

## ユースケース詳細

### UC01: コピー元フォルダを選択

| 項目 | 内容 |
|------|------|
| ID | UC01 |
| 名称 | コピー元フォルダを選択 |
| アクター | ユーザー |
| 事前条件 | アプリケーションが起動している |
| 事後条件 | コピー元パスが設定される |
| 基本フロー | 1. ユーザーが「参照...」ボタンをクリック<br/>2. フォルダ選択ダイアログが表示される<br/>3. ユーザーがフォルダを選択してOKをクリック<br/>4. 選択したパスがテキストボックスに表示される<br/>5. CUIコマンドが自動更新される |
| 代替フロー | 3a. ユーザーがキャンセルをクリック → 変更なし |

### UC02: コピー先フォルダを選択

| 項目 | 内容 |
|------|------|
| ID | UC02 |
| 名称 | コピー先フォルダを選択 |
| アクター | ユーザー |
| 事前条件 | アプリケーションが起動している |
| 事後条件 | コピー先パスが設定される |
| 基本フロー | 1. ユーザーが「参照...」ボタンをクリック<br/>2. フォルダ選択ダイアログが表示される<br/>3. ユーザーがフォルダを選択してOKをクリック<br/>4. 選択したパスがテキストボックスに表示される<br/>5. CUIコマンドが自動更新される |
| 代替フロー | 3a. ユーザーがキャンセルをクリック → 変更なし |

### UC03: コピーオプションを設定

| 項目 | 内容 |
|------|------|
| ID | UC03 |
| 名称 | コピーオプションを設定 |
| アクター | ユーザー |
| 事前条件 | アプリケーションが起動している |
| 事後条件 | 選択したオプションが有効になる |
| 基本フロー | 1. ユーザーがオプションのチェックボックスをクリック<br/>2. オプションの選択状態が変更される<br/>3. CUIコマンドが自動更新される |

### UC04: ファイル一覧を確認

| 項目 | 内容 |
|------|------|
| ID | UC04 |
| 名称 | ファイル一覧を確認 |
| アクター | ユーザー、robocopy.exe |
| 事前条件 | コピー元フォルダとコピー先フォルダが設定されている |
| 事後条件 | 実際にコピーされるファイルの一覧が表示される |
| 基本フロー | 1. ユーザーが「確認」ボタンをクリック<br/>2. robocopyが`/L`オプション（リスト表示のみ）で実行される<br/>3. ステータスが「robocopyでコピー対象を確認中...」に変更<br/>4. コピーオプションを反映したファイル一覧がDataGridに表示される<br/>5. 各ファイルにコピー理由（新規/更新/変更など）が表示される<br/>6. ファイル数と合計サイズが表示される<br/>7. ステータスが「確認完了」に変更 |
| 代替フロー | 2a. コピー元が存在しない → エラーメッセージ表示<br/>2b. コピー先が未設定 → エラーメッセージ表示 |
| 備考 | コピーオプション（`/XO`での古いファイル除外など）を反映した正確なファイル一覧が取得される |

### UC05: コピーを実行

| 項目 | 内容 |
|------|------|
| ID | UC05 |
| 名称 | コピーを実行 |
| アクター | ユーザー、robocopy.exe |
| 事前条件 | コピー元・コピー先フォルダが設定されている |
| 事後条件 | ファイルがコピーされる |
| 基本フロー | 1. ユーザーが「実行」ボタンをクリック<br/>2. 確認/実行ボタンが中止ボタンに切り替わる<br/>3. robocopyプロセスが起動される<br/>4. 進捗がプログレスバーに表示される<br/>5. コピー完了後、完了メッセージが表示される<br/>6. 中止ボタンが確認/実行ボタンに戻る |
| 代替フロー | 5a. エラー発生 → エラーメッセージ表示 |

### UC06: コピーを中止

| 項目 | 内容 |
|------|------|
| ID | UC06 |
| 名称 | コピーを中止 |
| アクター | ユーザー |
| 事前条件 | コピーが実行中である |
| 事後条件 | コピーが中止される |
| 基本フロー | 1. ユーザーが「中止」ボタンをクリック<br/>2. キャンセル処理が開始される<br/>3. robocopyプロセスが強制終了される<br/>4. キャンセルメッセージが表示される<br/>5. 中止ボタンが確認/実行ボタンに戻る |

### UC07: CUIコマンドを確認

| 項目 | 内容 |
|------|------|
| ID | UC07 |
| 名称 | CUIコマンドを確認 |
| アクター | ユーザー |
| 事前条件 | コピー元・コピー先が設定されている |
| 事後条件 | なし（表示のみ） |
| 基本フロー | 1. ユーザーがCUIコマンド出力欄を確認<br/>2. 生成されたrobocopyコマンドが表示されている |

### UC08: 進捗を確認

| 項目 | 内容 |
|------|------|
| ID | UC08 |
| 名称 | 進捗を確認 |
| アクター | ユーザー |
| 事前条件 | コピーが実行中である |
| 事後条件 | なし（表示のみ） |
| 基本フロー | 1. プログレスバーで進捗率を確認<br/>2. ステータスメッセージで現在のファイルを確認 |
